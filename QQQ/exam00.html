<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ÂÆåÊï¥Âà∑È¢òÈ°µÈù¢</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f2f5;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h4 {
            white-space: pre;
        }

        .question-container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-type {
            background: #409eff;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
        }

        .question-index {
            color: #666;
            font-size: 14px;
        }

        .content {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 24px;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-button {
            padding: 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s;
        }

        .option-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .option-button.selected {
            border-color: #409eff;
            background: #ecf5ff;
        }

        .option-button.correct {
            border-color: #67c23a;
            background: #f0f9eb;
        }

        .option-button.wrong {
            border-color: #f56c6c;
            background: #fef0f0;
        }

        .option-button.partial {
            border-color: #e6a23c;
            background: #fdf6ec;
        }

        .submit-button {
            margin-top: 20px;
            padding: 12px 32px;
            background: #409eff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
        }

        .submit-button:hover {
            background: #66b1ff;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .nav-button {
            padding: 10px 20px;
            background: #0b6fde;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .nav-button-random {
            padding: 10px 20px;
            background: #de6f0b;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .nav-button:disabled {
            background: #c0c4cc;
            cursor: not-allowed;
        }

        .analysis {
            margin-top: 24px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .statistics {
            margin-top: 16px;
            color: #666;
            font-size: 14px;
        }

        .result-message {
            margin: 16px 0;
            padding: 12px;
            border-radius: 6px;
            font-weight: bold;
        }

        .correct-message {
            background: #f0f9eb;
            color: #67c23a;
        }

        .wrong-message {
            background: #fef0f0;
            color: #f56c6c;
        }
    </style>
</head>
<body>
<div id="app">
    <div class="container">
        <div class="question-container">
            <input
                    class="question-header"
                    v-model="chapterIndex"
                    @change="GotoChapter"
                    placeholder="1"
                    @keyup.enter="GotoChapter"
            >
            <!-- È¢òÁõÆÂ§¥ÈÉ® -->
            <div class="question-header">
                <span class="question-type">{{ questionTypeText }}</span>
                <span class="question-index">{{ currentIndex + 1 }}/{{ questions.length }}</span>
            </div>

            <!-- È¢òÁõÆÂÜÖÂÆπ -->
            <div class="content" v-html="decodeContent(question.content)"></div>

            <!-- ÈÄâÈ°πÂàóË°® -->
            <div class="options">
                <button
                        v-for="(option, index) in question.questionOptionRspList"
                        :key="option.id"
                        class="option-button"
                        :class="getOptionClass(option)"
                        @click="toggleOption(option)"
                        :disabled="showAnalysis"
                >
                        <span v-if="isMultiple">
                            <input
                                    type="checkbox"
                                    style="pointer-events: none;"
                            >
                        </span>
                    {{ String.fromCharCode(65 + index) }}. {{ decodeContent(option.content) }}
                </button>
            </div>

            <!-- Â§öÈÄâÈ¢òÊèê‰∫§ÊåâÈíÆ -->
            <button
                    v-if="isMultiple && !showAnalysis && selectedOptions.length > 0"
                    class="submit-button"
                    @click="submitAnswer"
            >
                Êèê‰∫§Á≠îÊ°à
            </button>

            <!-- Á≠îÈ¢òÁªìÊûú -->
            <div
                    v-if="showAnalysis"
                    class="result-message"
                    :class="isAllCorrect ? 'correct-message' : 'wrong-message'"
            >
                {{ isAllCorrect ? 'üéâ ÂõûÁ≠îÊ≠£Á°ÆÔºÅ' : '‚ùå ÂõûÁ≠îÈîôËØØÔºÅ' }}
            </div>
            <!-- ÂØºËà™ÊåâÈíÆ -->
            <div class="navigation">
                <button
                        class="nav-button"
                        @click="prevQuestion"
                        :disabled="currentIndex === 0"
                >
                    ‰∏ä‰∏ÄÈ¢ò
                </button>
                <button
                        class="nav-button-random"
                        @click="randomQuestion"
                        :disabled="currentIndex === 0"
                >
                    ÈöèÊú∫‰∏ä‰∏ÄÈ¢ò
                </button>

                <input
                        type="number"
                        v-model="qIndex"
                        @change="GotoQuestion"
                        placeholder="ËæìÂÖ•È¢òÂè∑"
                        @keyup.enter="GotoQuestion"

                >
                <button
                        class="nav-button-random"
                        @click="randomQuestion"
                        :disabled="currentIndex === questions.length - 1"
                >
                    ÈöèÊú∫‰∏ã‰∏ÄÈ¢ò
                </button>
                <button
                        class="nav-button"
                        @click="nextQuestion"
                        :disabled="currentIndex === questions.length - 1"
                >
                    ‰∏ã‰∏ÄÈ¢ò
                </button>
            </div>

            <!-- Á≠îÊ°àËß£Êûê -->
            <div v-if="showAnalysis" class="analysis">
                <h4>{{question.questionChapterRsp.chapterName}}</h4>
                <h4>
                    {{question.questionChapterRsp.childChapterName}}&nbsp; &nbsp; &nbsp;
                    {{question.questionChapterRsp.childKnowledgeName}}</h4>
                <h3>üìñ Á≠îÊ°àËß£Êûê</h3>
                <div v-html="question.analysis"></div>
                <div class="statistics">
                    <p>‚úÖ Ê≠£Á°ÆÁéáÔºö{{ question.rightRatio }}%</p>
                </div>
            </div>


        </div>
    </div>
</div>

<script>
    const {createApp, ref, computed, watch, onMounted} = Vue;

    // ÈùôÊÄÅÈ¢òÁõÆÊï∞ÊçÆ


    createApp({
        setup() {
            const questions = ref([])
            const currentIndex = ref(0);
            const selectedOptions = ref([]);
            const showAnalysis = ref(false);
            const qIndex = ref('')
            const chapterIndex = ref(1)
            let currentQuestion = ref({})


            onMounted(async () => {
                const url = 'https://raw.githubusercontent.com/silvio27/MapCF/refs/heads/main/QQQ/chapter/' + chapterIndex.value + '.json'

                try {
                    const response = await fetch(url)
                    if (!response.ok) throw new Error('Âä†ËΩΩÂ§±Ë¥•')
                    const data = await response.json()
                    questions.value = data
                    console.log('È¢òÁõÆÂä†ËΩΩÊàêÂäü:', questions.value)

                    currentQuestion.value = questions.value[currentIndex.value];
                } catch (error) {
                    console.error('Âä†ËΩΩÂ§±Ë¥•:', error)
                }


            })


            // ÁõëÂê¨È¢òÁõÆÁ¥¢ÂºïÂèòÂåñ
            watch(currentIndex, (newVal) => {
                currentQuestion.value = questions.value[newVal];
                resetState();
            });


            // Âà§Êñ≠ÊòØÂê¶Â§öÈÄâÈ¢ò
            const isMultiple = computed(() => {
                return currentQuestion.value.baseQuestionType === 2;
            });

            // È¢òÂûãÊòæÁ§∫ÊñáÊú¨
            const questionTypeText = computed(() => {
                return isMultiple.value ? 'Â§öÈÄâÈ¢ò' : 'ÂçïÈÄâÈ¢ò';
            });

            // Ëß£Á†ÅBase64ÂÜÖÂÆπ
            const decodeContent = (str) => {
                try {
                    return decodeURIComponent(escape(atob(str)));
                } catch (e) {
                    return str;
                }
            };

            // Â§ÑÁêÜÈÄâÈ°πÂàáÊç¢
            const toggleOption = (option) => {
                if (!isMultiple.value) {
                    selectedOptions.value = [option.id];
                    showAnalysis.value = true;
                } else {
                    const index = selectedOptions.value.indexOf(option.id);
                    if (index > -1) {
                        selectedOptions.value.splice(index, 1);
                    } else {
                        selectedOptions.value.push(option.id);
                    }
                }
            };

            // Êèê‰∫§Â§öÈÄâÈ¢òÁ≠îÊ°à
            const submitAnswer = () => {
                showAnalysis.value = true;
            };

            // ÂàáÊç¢È¢òÁõÆÊó∂ÈáçÁΩÆÁä∂ÊÄÅ
            const resetState = () => {
                selectedOptions.value = [];
                showAnalysis.value = false;
            };

            // Ëé∑ÂèñÈÄâÈ°πÊ†∑Âºè
            const getOptionClass = (option) => {
                const isSelected = selectedOptions.value.includes(option.id);
                const isCorrect = option.isCorrectAnswer;

                if (!showAnalysis.value) {
                    return {selected: isSelected};
                }

                return {
                    correct: isCorrect,
                    wrong: isSelected && !isCorrect,
                    partial: isSelected && isCorrect && isMultiple.value
                };
            };

            // Âà§Êñ≠ÊòØÂê¶ÂÖ®ÈÉ®Ê≠£Á°Æ
            const isAllCorrect = computed(() => {
                if (!showAnalysis.value) return false;

                const correctIds = currentQuestion.value.questionOptionRspList
                    .filter(opt => opt.isCorrectAnswer)
                    .map(opt => opt.id);

                // ÂØπÂ§öÈÄâÈ¢òÈúÄË¶ÅÂÆåÂÖ®ÂåπÈÖç
                if (isMultiple.value) {
                    return correctIds.length === selectedOptions.value.length &&
                        correctIds.every(id => selectedOptions.value.includes(id));
                }

                // ÂçïÈÄâÈ¢òÁõ¥Êé•ÊØîËæÉ
                return correctIds[0] === selectedOptions.value[0];
            });

            // ÂØºËà™ÂäüËÉΩ
            const prevQuestion = () => {
                if (currentIndex.value > 0) currentIndex.value--;
            };

            const nextQuestion = () => {
                if (currentIndex.value <= questions.value.length - 1) {
                    currentIndex.value++
                }
                ;
            };


            const GotoChapter = async () => {
                const url = 'https://raw.githubusercontent.com/silvio27/MapCF/refs/heads/main/QQQ/chapter/' + chapterIndex.value + '.json'

                try {
                    const response = await fetch(url)
                    if (!response.ok) throw new Error('Âä†ËΩΩÂ§±Ë¥•')
                    const data = await response.json()
                    questions.value = data
                    console.log('È¢òÁõÆÂä†ËΩΩÊàêÂäü:', questions.value)
                    alert("È¢òÂ∫ìÂ∑≤Êõ¥Êñ∞Âà∞ÔºåÁ¨¨" + chapterIndex.value + "Á´†")

                    currentQuestion.value = questions.value[currentIndex.value];
                } catch (error) {
                    console.error('Âä†ËΩΩÂ§±Ë¥•:', error)
                }

            }

            const GotoQuestion = () => {
                currentIndex.value = qIndex.value - 1
            }

            const randomQuestion = () => {
                let index = Math.floor(Math.random() * (questions.value.length - 0) + 0)
                // alert(index)
                currentIndex.value = index
            }

            return {
                currentIndex,
                question: currentQuestion,
                questions,
                selectedOptions,
                showAnalysis,
                isMultiple,
                questionTypeText,
                isAllCorrect,
                decodeContent,
                toggleOption,
                submitAnswer,
                getOptionClass,
                prevQuestion,
                nextQuestion,
                randomQuestion,
                GotoQuestion,
                qIndex,
                chapterIndex,
                GotoChapter,
            };
        }
    }).mount('#app');
</script>
</body>
</html>